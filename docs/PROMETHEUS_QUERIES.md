# üìä Prometheus Queries for Spring Boot (Micrometer + Actuator)

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –ø–æ–ª–µ–∑–Ω—ã—Ö PromQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Spring Boot-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–º Micrometer + Prometheus.

---

## üî¢ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º
```promql
sum by (method) (http_server_requests_seconds_count)
```
–°—á–∏—Ç–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (GET, POST –∏ —Ç.–¥.) –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è.

---

## ‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ URI
```promql
sum by (uri) (http_server_requests_seconds_sum)
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å—É–º–º–µ –∑–∞–Ω—è–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ `/api/users`).

---

## üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É)
```promql
rate(http_server_requests_seconds_count[1m])
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å—Ä–µ–¥–Ω–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥.

---

## üß≠ –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–∑—Ä–µ–∑–µ HTTP-–º–µ—Ç–æ–¥–æ–≤
```promql
sum by (method) (rate(http_server_requests_seconds_count[1m]))
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥—É –ø–æ –∫–∞–∂–¥–æ–º—É HTTP-–º–µ—Ç–æ–¥—É.

---

## ‚ö†Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ 4xx
```promql
sum by (status) (http_server_requests_seconds_count{status=~"4.."})
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 400, 404).

---

## üî• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ 5xx
```promql
sum by (status) (http_server_requests_seconds_count{status=~"5.."})
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 500, 503).

---

## ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ POST-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ /api/users
```promql
http_server_requests_seconds_count{method="POST", uri="/api/users"}
```
–ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ç—Ä–µ–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∫–∏–µ-—Ç–æ –≤–∞–∂–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

---

## üîé –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º
```promql
sum by (method, status) (http_server_requests_seconds_count)
```
–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞: —Å–∫–æ–ª—å–∫–æ GET —Å 200, —Å–∫–æ–ª—å–∫–æ POST —Å 201 –∏ —Ç.–¥.

---

## ‚è±Ô∏è –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ URI
```promql
rate(http_server_requests_seconds_sum[1m]) / rate(http_server_requests_seconds_count[1m])
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö) –ø–æ –∫–∞–∂–¥–æ–º—É URI.

---

## ‚è±Ô∏è –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å POST-–∑–∞–ø—Ä–æ—Å–æ–≤
```promql
rate(http_server_requests_seconds_sum{method="POST"}[1m]) / rate(http_server_requests_seconds_count{method="POST"}[1m])
```
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–∫–æ—Ä–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä POST.

---

## üßº –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫
```promql
sum by (status) (http_server_requests_seconds_count{error="none"})
```
–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üîÑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç (–≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Ü–∏—Ñ—Ä–∞—Ö)
```promql
increase(http_server_requests_seconds_count[5m])
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∑–∞ 5 –º–∏–Ω—É—Ç (–ø–æ –≤—Å–µ–º –º–µ—Ç–æ–¥–∞–º/—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º).

---

## üõ†Ô∏è –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```promql
{__name__=~".*"}
```
–í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Prometheus. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–µ–π–±–ª–æ–≤.

---

> üí° **–ü–æ–¥—Å–∫–∞–∑–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–π `/actuator/prometheus` –∫–∞–∫ endpoint –º–µ—Ç—Ä–∏–∫ –≤ Spring Boot, –∏ –Ω–∞—Å—Ç—Ä–æ–π `PrometheusText` –≤ `scrape_protocols`, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é Prometheus.